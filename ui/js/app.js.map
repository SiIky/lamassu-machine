{"version":3,"sources":["../src/app.js"],"names":["queryString","window","location","search","params","URLSearchParams","substring","SCREEN","get","DEBUG_MODE","CASH_OUT_QR_COLOR","CASH_IN_QR_COLOR","NUMBER_OF_BUTTONS","scrollSize","textHeightQuantity","currentPage","totalPages","aspectRatio","isTwoWay","isRTL","two","cryptomatModel","termsConditionsTimeout","termsConditionsAcceptanceInterval","termsConditionsAcceptanceTimeout","T_C_TIMEOUT","complianceTimeout","fiatCode","locale","defaultLocale","loadI18n","localeCode","jsLocaleCode","_primaryLocales","lastRates","coins","currentState","accepting","websocket","wifiKeyboard","promoKeyboard","usSsnKeypad","phoneKeypad","securityKeypad","previousState","buttonActive","cassettes","currentCryptoCode","currentCoin","currentCoins","customRequirementNumericalKeypad","customRequirementTextKeyboard","customRequirementChoiceList","viewportButtonEventsActive","viewportEvents","customRequirementTextKeyboardNumberOfBoxes","MUSEO","groupBy","arr","by","ret","elem","key","Object","hasOwn","push","sumBy","x","partitionBy","yes","no","connect","console","log","HOST","PORT","WebSocket","onmessage","event","data","$","parseJSON","processData","onerror","err","verifyConnection","readyState","CLOSED","buttonPressed","button","deactivate","setTimeout","activate","res","send","JSON","stringify","screenOpts","setScreenOptions","localeInfo","setLocaleInfo","setLocale","supportedCoins","setCoins","setFiatCode","rates","setExchangeRate","buyerAddress","setBuyerAddress","credit","lastBill","action","setCredit","tx","setTx","wifiList","setWifiList","wifiSsid","setWifiSsid","sendOnly","reason","fiatCredit","depositInfo","setDepositAddress","version","setVersion","buildCassetteButtons","sent","total","setPartialSend","readingBills","cryptoCode","translateCoin","cashInFee","setFixedFee","cashOutFee","terms","setTermsScreen","dispenseBatch","direction","setDirection","operatorInfo","setOperatorInfo","hardLimit","setHardLimit","setCryptomatModel","areThereAvailablePromoCodes","undefined","setAvailablePromoCodes","allRates","ratesFiat","setRates","discount","setCurrentDiscount","receiptStatus","setReceiptPrint","smsReceiptStatus","automaticPrint","setAutomaticPrint","context","hide","show","isRecycler","billValidator","setState","t","translate","text","setComplianceTimeout","disableRecyclerBillButtons","enableRecyclerBillButtons","setAccepting","highBill","highestBill","minimumTx","lowestBill","isCashInOnlyCoin","chooseFiat","deposit","fiatReceipt","fiatComplete","chooseCoin","twoWayMode","smsVerification","threshold","idVerification","facephotoPermission","usSsnPermission","blockedCustomer","customInfoRequestPermission","customInfoRequest","suspiciousAddress","blacklistMessage","snakecase","fetchArgs","fetch","error","e","setScreen","screen1","title","interval","complianceButton","clearTimeout","input","type","screen2","setOpts","constraint","constraintType","maxLength","numDigits","label1","label2","label3","removeClass","setConstraint","addClass","replaceChoices","choiceList","setChooseCoinColors","defaultCoin","slice","setCryptoBuy","setCryptoSell","setupCoinsButtons","openLanguageDropdown","closeLanguageDropdown","openCoinDropdown","closeCoinDropdown","empty","dropdownCoins","length","showMoreButton","forEach","coin","activeClass","el","toLowerCase","display","append","each","html","trim","cashIn","translatedCoin","buyStr","cashOut","sellStr","getCryptoCurrency","cryptoCurrency","find","c","Error","switchCoin","selectedIndex","indexOf","it","splice","document","ready","attachFastClick","Origami","fastclick","body","addEventListener","calculateAspectRatio","onclick","oncontextmenu","onmousedown","onmousemove","onmouseup","BigNumber","config","ROUNDING_MODE","ROUND_HALF_EVEN","Keyboard","id","inputBox","init","Keypad","result","country","submitButtonWrapper","ChoiceList","setInterval","initTranslatePage","wifiNetworkButtons","getElementById","touchEvent","target","attr","moreNetworks","networkButton","closest","ssidEl","ssid","displaySsid","rawSsid","wifiConnectButton","wifiConnectButtonJ","pass","sendCoinsButton","sendCoinsButton2","setupButton","blockedCustomerOk","insertBillCancelButton","touchImmediateEvent","insertBillCancelRecyclerButton","setupImmediateButton","enableViewportButtonEvents","promoCodeCancelButton","bind","submitCodeButton","code","submitTextRequirementButton","nextFieldTextRequirementButton","previousFieldTextRequirementButton","text1","text2","text3","filter","join","val","setInputBox","fieldState","getInputBox","finalState","cryptoButtons","is","wantedCoin","areYouSureCancel","areYouSureContinue","coinRedeem","otherLocale","cashInBox","cashOutBox","languageOverlay","cryptoOverlay","languageButtons","languageButtonJ","newLocale","buildCassetteButtonEvents","initDebug","disableViewportButtonEvents","disableImmediateButton","targetButton","element","classList","special","contains","parentNode","callback","handler","add","remove","stopPropagation","preventDefault","shouldEnableTouch","includes","buttonClass","buttonAction","disableTouchImmediateEvent","removeEventListener","actionData","newScreen","oldScreen","css","top","left","newView","state","delay","clearTermsConditionsTimeout","clearTermsConditionsAcceptanceDelay","reset","revertScreen","recs","requestedPage","networks","page","offset","remainingCount","len","Math","min","i","rec","bars","floor","strength","moreTxt","setUpDirectionElement","operator","active","name","email","phone","limits","component","hardLimitWeeks","hardLimitDays","hardLimitHours","model","versions","startsWith","continueButton","finishButton","disabled","states","$screen","startPage","acceptDisabled","cancel","accept","setTermsConditionsTimeout","setAcceptButtonDisabled","setTermsConditionsAcceptanceDelay","screen","acceptButton","prop","Boolean","delayTimer","isNaN","seconds","tmpbtn","clone","appendTo","width","outerWidth","clearInterval","resetTermsConditionsTimeout","scrollUp","div","updateButtonStyles","updatePageCounter","scrollTo","acceptedTerms","offsetHeight","style","ceil","textContent","scrollDown","buttonDown","buttonUp","setCountry","setPrimaryLocales","primaryLocales","primaryLocale","otherLanguageName","lang","lookupLocaleNames","nativeName","split","isArabic","isHebrew","translatePage","ex","img","areArraysEqual","arr1","arr2","langMap","languageMappingList","language","localeNames","languages","sortedPrimaryLocales","sort","a","b","langA","langB","englishName","localeCompare","l","toggleClass","_fee","fee","parseFloat","fixedFee","formatFiat","fiat","cryptoAtoms","scale","pow","displayScale","cryptoAmount","toNumber","cryptoDisplayCode","displayCode","updateCrypto","inserted","formatDenomination","denom","toLocaleString","useGrouping","maximumFractionDigits","minimumFractionDigits","_cassettes","numberOfButtons","map","isVirtual","count","isActive","assign","virtualCassettes","physicalCassettes","entries","denomination","activeCassettes","inactiveCassettes","concat","updateCassetteButtons","activeDenoms","children","fiatButtons","lastTouch","now","Date","cashButtonJ","hasClass","selector","formatCrypto","lookupDecimalChar","num","localized","splitNumber","localize","decimalChar","formatNumber","amount","fractionDigits","_rates","cryptoToFiat","rateStr","round","cashOutCryptoToFiat","qrize","color","lightning","size","image","_size","clientHeight","opts","crisp","fill","render","rounded","quiet","mPosX","mPosY","mSize","mode","kjua","txId","isPaperWallet","hasBills","bills","promoCodeApplied","formatAddressNoBreakLines","address","replace","formatAddress","toBr","currentAccepting","transition","y","reasonText","bill","errorMessages","transactionLimit","validatorError","lowBalance","str","base","messages","locales","Jed","reachFiatLimit","msg","isEmpty","txLimitReached","displayCrypto","decimalPlaces","unitScale","cryptoDisplay","BN","s","activeDenominations","fiatDisplay","eq","activeMap","toAddress","depositUrl","of","current","createElement","innerHTML","getElementsByTagName","appendChild","height","gcd","w","h","r","aspectRatioPt1","aspectRatioPt2","background","doTransition","cb","toShow","toShowOver","start","tl","TimelineMax","set","opacity","zIndex","to","onStart","pause","setupAnimation","isAr800","firstChild","removeChild","Two","fullscreen","Types","svg","autostart","elementId","interpret","ua","navigator","userAgent","match","chromiumVersion","chromeVersion","chromiumPlus73","chromePlus73","currentDiscount","successMessage","status","className","printing","success","message","failMessage","thousandSeparator","number","numberFormatter","Intl","NumberFormat","format","ratesTable","tableHeader","coinEntries","keys","toFixed"],"mappings":"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","file":"app.js","sourcesContent":["/* globals $, URLSearchParams, WebSocket, locales, Keyboard, Keypad, Jed, BigNumber, HOST, PORT, Origami, kjua, TimelineMax, Two */\n'use strict'\n\nconst queryString = window.location.search\nconst params = new URLSearchParams(queryString.substring(1))\nconst SCREEN = params.get('screen')\nconst DEBUG_MODE = SCREEN ? 'demo' : params.get('debug')\nconst CASH_OUT_QR_COLOR = '#403c51'\nconst CASH_IN_QR_COLOR = '#0e4160'\nconst NUMBER_OF_BUTTONS = 3\n\nvar scrollSize = 0\nvar textHeightQuantity = 0\nvar currentPage = 0\nvar totalPages = 0\nvar aspectRatio = '16:10'\nvar isTwoWay = null\nvar isRTL = false\nvar two = null\nvar cryptomatModel = null\nvar termsConditionsTimeout = null\nvar termsConditionsAcceptanceInterval = null\nvar termsConditionsAcceptanceTimeout = null\nvar T_C_TIMEOUT = 30000\nvar complianceTimeout = null;\n\nvar fiatCode = null\nvar locale = null\nvar defaultLocale = loadI18n('en-US') || null\nvar localeCode = null\nvar jsLocaleCode = null // Sometimes slightly different than localeCode\nvar _primaryLocales = []\nvar lastRates = null\nvar coins\n\nvar currentState\n\nvar accepting = false\nvar websocket = null\nvar wifiKeyboard = null\nvar promoKeyboard = null\nvar usSsnKeypad = null\nvar phoneKeypad = null\nvar securityKeypad = null\nvar previousState = null\nvar buttonActive = true\nvar cassettes = null\nlet currentCryptoCode = null\nlet currentCoin = null\nlet currentCoins = []\nlet customRequirementNumericalKeypad = null\nlet customRequirementTextKeyboard = null\nlet customRequirementChoiceList = null\nvar viewportButtonEventsActive = null\nvar viewportEvents = {}\nvar customRequirementTextKeyboardNumberOfBoxes = 2\n\nvar MUSEO = ['ca', 'cs', 'da', 'de', 'en', 'es', 'et', 'fi', 'fr', 'hr',\n  'hu', 'it', 'lt', 'nb', 'nl', 'pl', 'pt', 'ro', 'sl', 'sv', 'tr']\n\nfunction groupBy (arr, by) {\n  const ret = {}\n  for (const elem of arr) {\n    const key = by(elem)\n    if (Object.hasOwn(ret, key))\n      ret[key].push(elem)\n    else\n      ret[key] = [elem]\n  }\n  return ret\n}\n\nfunction sumBy (arr, by) {\n  let ret = 0\n  for (const x of arr)\n    ret += by(x)\n  return ret\n}\n\nfunction partitionBy (arr, by) {\n    const [yes, no] = [[], []]\n    for (const x of arr)\n        (by(x) ? yes : no).push(x)\n    return [yes, no]\n}\n\nfunction connect () {\n  console.log(`ws://${HOST}:${PORT}/`)\n  websocket = new WebSocket(`ws://${HOST}:${PORT}/`)\n  websocket.onmessage = function (event) {\n    var data = $.parseJSON(event.data)\n    processData(data)\n  }\n  websocket.onerror = err => console.log(err)\n}\n\nfunction verifyConnection () {\n  if (websocket.readyState === websocket.CLOSED) {\n    connect()\n  }\n}\n\nfunction buttonPressed (button, data) {\n  if (!buttonActive) return\n  wifiKeyboard.deactivate()\n  promoKeyboard.deactivate()\n  customRequirementTextKeyboard.deactivate()\n  buttonActive = false\n  setTimeout(function () {\n    buttonActive = true\n    wifiKeyboard.activate()\n    promoKeyboard.activate()\n    customRequirementTextKeyboard.activate()\n  }, 300)\n  var res = { button: button }\n  if (data || data === null) res.data = data\n  if (websocket) websocket.send(JSON.stringify(res))\n}\n\nfunction processData (data) {\n  if (data.screenOpts) setScreenOptions(data.screenOpts)\n  if (data.localeInfo) setLocaleInfo(data.localeInfo)\n  if (data.locale) setLocale(data.locale)\n  if (data.supportedCoins) setCoins(data.supportedCoins)\n  if (!locale) return\n  if (data.fiatCode) setFiatCode(data.fiatCode)\n  if (data.rates) setExchangeRate(data.rates)\n  if (data.buyerAddress) setBuyerAddress(data.buyerAddress)\n  if (data.credit) {\n    var lastBill = data.action === 'rejectedBill' ? null : data.credit.lastBill\n    setCredit(data.credit, lastBill)\n  }\n  if (data.tx) setTx(data.tx)\n  if (data.wifiList) setWifiList(data.wifiList)\n  if (data.wifiSsid) setWifiSsid(data.wifiSsid)\n  if (data.sendOnly) sendOnly(data.reason)\n  if (data.fiatCredit) fiatCredit(data.fiatCredit)\n  if (data.depositInfo) setDepositAddress(data.depositInfo)\n  if (data.version) setVersion(data.version)\n  if (data.cassettes) buildCassetteButtons(data.cassettes, NUMBER_OF_BUTTONS)\n  if (data.sent && data.total) setPartialSend(data.sent, data.total)\n  if (data.readingBills) readingBills(data.readingBills)\n  if (data.cryptoCode) translateCoin(data.cryptoCode)\n  if (data.tx) {\n    if (data.tx.cashInFee) setFixedFee(data.tx.cashInFee)\n    else if (data.tx.cashOutFee) setFixedFee(data.tx.cashOutFee)\n  }\n  if (data.terms) setTermsScreen(data.terms)\n  if (data.dispenseBatch) dispenseBatch(data.dispenseBatch)\n  if (data.direction) setDirection(data.direction)\n  if (data.operatorInfo) setOperatorInfo(data.operatorInfo)\n  if (data.hardLimit) setHardLimit(data.hardLimit)\n  if (data.cryptomatModel) setCryptomatModel(data.cryptomatModel)\n  if (data.areThereAvailablePromoCodes !== undefined) setAvailablePromoCodes(data.areThereAvailablePromoCodes)\n  if (data.allRates && data.ratesFiat) setRates(data.allRates, data.ratesFiat)\n\n  if (data.tx && data.tx.discount) setCurrentDiscount(data.tx.discount)\n  if (data.receiptStatus) setReceiptPrint(data.receiptStatus, null)\n  if (data.smsReceiptStatus) setReceiptPrint(null, data.smsReceiptStatus)\n  if (data.automaticPrint) setAutomaticPrint(data.automaticPrint)\n\n  if (data.context) {\n    $('.js-context').hide()\n    $('.js-context-' + data.context).show()\n  }\n\n  const isRecycler = billValidator => {\n    return billValidator === 'HCM2'\n  }\n\n  switch (data.action) {\n    case 'wifiList':\n      if (cryptomatModel === 'douro1') {\n        setState('wifi')\n      } else {\n        setState('connect_ethernet')\n      }\n      break\n    case 'wifiPass':\n      setState('wifi_password')\n      break\n    case 'wifiConnecting':\n      t('wifi-connecting', translate('This could take a few moments.'))\n      setState('wifi_connecting')\n      break\n    case 'wifiConnected':\n      t('wifi-connecting', translate('Connected. Waiting for ticker.'))\n      setState('wifi_connecting') // in case we didn't go through wifi-connecting\n      break\n    case 'pairing':\n      setState('pairing')\n      break\n    case 'pairingError':\n      $('.js-pairing-error').text(data.err)\n      // Give it some time to update text in background\n      setTimeout(function () { setState('pairing_error') }, 500)\n      break\n    case 'booting':\n      if (currentState !== 'maintenance') setState('booting')\n      break\n    case 'idle':\n    case 'fakeIdle':\n      setState('idle')\n      break\n    case 'dualIdle':\n    case 'fakeDualIdle':\n      setState('dual_idle')\n      break\n    case 'registerUsSsn':\n      usSsnKeypad.activate()\n      setState('register_us_ssn')\n      setComplianceTimeout(null, 'finishBeforeSms')\n      break\n    case 'registerPhone':\n      phoneKeypad.activate()\n      setState('register_phone')\n      break\n    case 'securityCode':\n      securityKeypad.activate()\n      setState('security_code')\n      break\n    case 'scanned':\n      $('.js-send-crypto-disable').hide()\n      $('.js-send-crypto-enable').show()\n      isRecycler(data.billValidator)\n        ? setState('insert_first_bills_recycler')\n        : setState('insert_bills')\n      break\n    case 'acceptingFirstBill':\n      $('.js-send-crypto-enable').show()\n      setState('insert_bills')\n      break\n    case 'acceptingBills':\n      $('.blocked-customer-top').hide()\n      setState('insert_more_bills')\n      break\n    case 'acceptingFirstRecyclerBills':\n      $('.js-continue-crypto-enable').show()\n      $('.js-send-crypto-enable').show()\n      setState('insert_first_bills_recycler')\n      break\n    case 'recyclerContinue':\n      disableRecyclerBillButtons()\n      break;\n    case 'acceptingRecyclerBills':\n      enableRecyclerBillButtons()\n      $('.blocked-customer-top').hide()\n      setState('insert_bills_recycler')\n      break\n    case 'acceptingBill':\n      setAccepting(true)\n      break\n    case 'rejectedBill':\n      setAccepting(false)\n      break\n    case 'cryptoTransferPending':\n      setState('sending_coins')\n      break\n    case 'cryptoTransferComplete':\n      setState('completed')\n      break\n    case 'networkDown':\n      setState('trouble')\n      break\n    case 'balanceLow':\n      setState('limit_reached')\n      break\n    case 'insufficientFunds':\n      setState('out_of_coins')\n      break\n    case 'highBill':\n      highBill(data.highestBill, data.reason)\n      break\n    case 'minimumTx':\n      minimumTx(data.lowestBill)\n      break\n    case 'chooseFiat':\n      if (data.isCashInOnlyCoin) {\n        setState('cash_in_only_coin')\n        break\n      }\n      chooseFiat(data.chooseFiat)\n      break\n    case 'deposit':\n      setState('deposit')\n      deposit(data.tx)\n      break\n    case 'rejectedDeposit':\n      setState('deposit_timeout')\n      break\n    case 'fiatReceipt':\n      fiatReceipt(data.tx)\n      break\n    case 'fiatComplete':\n      fiatComplete(data.tx)\n      break\n    case 'restart':\n      setState('restart')\n      break\n    case 'chooseCoin':\n      chooseCoin(data.coins, data.twoWayMode)\n      break\n    case 'smsVerification':\n      smsVerification(data.threshold)\n      break\n    case 'permission_id':\n      idVerification()\n      break\n    case 'permission_face_photo':\n      facephotoPermission()\n      break\n    case 'usSsnPermission':\n      usSsnPermission()\n      break\n    case 'blockedCustomer':\n      blockedCustomer()\n      break\n    case 'insertPromoCode':\n      promoKeyboard.activate()\n      setState('insert_promo_code')\n      break\n    case 'invalidPromoCode':\n      setState('promo_code_not_found')\n      break\n    case 'customInfoRequestPermission':\n      customInfoRequestPermission(data.customInfoRequest)\n      break\n    case 'inputCustomInfoRequest':\n      customInfoRequest(data.customInfoRequest)\n      break\n    case 'rates':\n      setState('rates')\n      break\n    case 'suspiciousAddress':\n      suspiciousAddress(data.blacklistMessage)\n      setState('suspicious_address')\n      break\n    case 'actionRequiredMaintenance':\n      setState('action_required_maintenance')\n      break\n    default:\n      if (data.action) setState(window.snakecase(data.action))\n  }\n}\n\nfunction translate (data, fetchArgs) {\n  if (data === \"\")\n    return data\n\n  try {\n    return fetchArgs\n      ? locale.translate(data).fetch(...fetchArgs)\n      : locale.translate(data).fetch()\n  } catch (error) {\n    if (!defaultLocale) console.error('Error while translating: ', error)\n    else {\n      try {\n        return fetchArgs\n          ? defaultLocale.translate(data).fetch(...fetchArgs)\n          : defaultLocale.translate(data).fetch()\n      } catch (e) {\n        console.error('Error while translating: ', e)\n        return data\n      }\n    }\n  }\n}\n\nfunction facephotoPermission () {\n  setComplianceTimeout(null, 'finishBeforeSms')\n  setScreen('permission_face_photo')\n}\n\nfunction usSsnPermission () {\n  setComplianceTimeout(null, 'finishBeforeSms')\n  setScreen('us_ssn_permission')\n}\n\nfunction customInfoRequestPermission (customInfoRequest) {\n  $('#custom-screen1-title').text(customInfoRequest.screen1.title)\n  $('#custom-screen1-text').text(customInfoRequest.screen1.text)\n  setComplianceTimeout(null, 'finishBeforeSms')\n  setScreen('custom_permission')\n}\n\nfunction setComplianceTimeout (interval, complianceButton) {\n  clearTimeout(complianceTimeout)\n\n  if (interval === 0) {\n    return\n  }\n\n  complianceTimeout = setTimeout(function () {\n    buttonPressed(complianceButton)\n  }, interval == null ? 60000 : interval)\n}\n\nfunction customInfoRequest (customInfoRequest) {\n  switch (customInfoRequest.input.type) {\n    case 'numerical':\n      $('#custom-screen2-numerical-title').text(customInfoRequest.screen2.title)\n      $('#custom-screen2-numerical-text').text(customInfoRequest.screen2.text)\n      customRequirementNumericalKeypad.setOpts({\n        type: 'custom',\n        constraint: customInfoRequest.input.constraintType,\n        maxLength: customInfoRequest.input.numDigits\n      })\n      customRequirementNumericalKeypad.activate()\n      setState('custom_permission_screen2_numerical')\n      setScreen('custom_permission_screen2_numerical')\n      setComplianceTimeout(null, 'cancelCustomInfoRequest')\n      break\n    case 'text':\n      $('#custom-requirement-text-label1').text(customInfoRequest.input.label1)\n      $('#custom-requirement-text-label2').text(customInfoRequest.input.label2)\n      $('#custom-requirement-text-label3').text(customInfoRequest.input.label3)\n      $('#previous-text-requirement').hide()\n      $('#submit-text-requirement').hide()\n      $('#next-text-requirement').hide()\n      $('#optional-text-field-2').hide()\n      $('#optional-text-field-3').hide()\n      $('.key.backspace.standard-backspace-key').removeClass('backspace-margin-left-override')\n      $('.custom-info-request-space-key').show()\n      // set type of constraint and buttons where that constraint should apply to disable/ enable\n      customRequirementTextKeyboard.setConstraint(customInfoRequest.input.constraintType, ['#submit-text-requirement'])\n      if (customInfoRequest.input.constraintType === 'spaceSeparation') {\n        $('#optional-text-field-2').show()\n        $('.key.backspace.standard-backspace-key').addClass('backspace-margin-left-override')\n        $('.custom-info-request-space-key').hide()\n\n        if (!!customInfoRequest.input.label3) {\n          $('#optional-text-field-3').show()\n          customRequirementTextKeyboard.setConstraint('spaceSeparationThreeFields', ['#next-text-requirement'])\n          customRequirementTextKeyboardNumberOfBoxes = 3\n        } else {\n          customRequirementTextKeyboard.setConstraint('spaceSeparation', ['#next-text-requirement'])\n          customRequirementTextKeyboardNumberOfBoxes = 2\n        }\n      }\n      setState('custom_permission_screen2_text')\n      setScreen('custom_permission_screen2_text')\n      setComplianceTimeout(null, 'cancelCustomInfoRequest')\n      break\n    case 'choiceList':\n      $('#custom-screen2-choiceList-title').text(customInfoRequest.screen2.title)\n      $('#custom-screen2-choiceList-text').text(customInfoRequest.screen2.text)\n      customRequirementChoiceList.replaceChoices(customInfoRequest.input.choiceList, customInfoRequest.input.constraintType)\n      setState('custom_permission_screen2_choiceList')\n      setScreen('custom_permission_screen2_choiceList')\n      setComplianceTimeout(null, 'cancelCustomInfoRequest')\n      break\n    default:\n      return blockedCustomer()\n  }\n}\n\nfunction idVerification () {\n  setComplianceTimeout(null, 'finishBeforeSms')\n  setScreen('permission_id')\n}\n\nfunction smsVerification (threshold) {\n  console.log('sms threshold to be displayed', threshold)\n  setComplianceTimeout(null, 'finishBeforeSms')\n  setScreen('sms_verification')\n}\n\nfunction blockedCustomer () {\n  return setScreen('blocked_customer')\n}\n\nfunction chooseCoin (coins, twoWayMode) {\n  if (twoWayMode) {\n    $('.choose_coin_state').removeClass('choose-coin-cash-in').addClass('choose-coin-two-way')\n  } else {\n    $('.choose_coin_state').removeClass('choose-coin-two-way').addClass('choose-coin-cash-in')\n  }\n\n  isTwoWay = twoWayMode\n  setChooseCoinColors()\n  // setupAnimation(twoWayMode, aspectRatio800)\n\n  const defaultCoin = coins[0]\n\n  currentCryptoCode = defaultCoin.cryptoCode\n  currentCoin = defaultCoin\n  currentCoins = coins.slice(0)\n\n  setCryptoBuy(defaultCoin)\n  setCryptoSell(defaultCoin)\n\n  setupCoinsButtons(coins, currentCryptoCode)\n\n  setState('choose_coin')\n}\n\nfunction openLanguageDropdown () {\n  $('#language-dropdown-toggle').addClass('hide')\n  $('#languages').removeClass('hide')\n  $('#language-overlay').removeClass('hide')\n}\n\nfunction closeLanguageDropdown () {\n  $('#language-dropdown-toggle').removeClass('hide')\n  $('#languages').addClass('hide')\n  $('#language-overlay').addClass('hide')\n}\n\nfunction openCoinDropdown () {\n  $('#crypto-dropdown-toggle').addClass('hide')\n  $('#crypto-overlay').removeClass('hide')\n  $('#cryptos').removeClass('hide')\n}\n\nfunction closeCoinDropdown () {\n  $('#crypto-dropdown-toggle').removeClass('hide')\n  $('#crypto-overlay').addClass('hide')\n  $('#cryptos').addClass('hide')\n}\n\nfunction setupCoinsButtons () {\n  $('.crypto-buttons').empty()\n  closeCoinDropdown()\n\n  let coins = currentCoins.slice()\n  let dropdownCoins = []\n\n  if (coins.length === 1) return\n\n  const showMoreButton = coins.length > 4\n  if (showMoreButton) {\n    $('crypto-dropdown-toggle').removeClass('hide')\n    dropdownCoins = coins.slice(3)\n    coins = coins.slice(0, 3)\n  } else {\n    $('crypto-dropdown-toggle').addClass('hide')\n  }\n\n  coins.forEach(function (coin) {\n    const activeClass = coin.cryptoCode === currentCryptoCode ? 'choose-coin-button-active' : ''\n    const el = `<div class=\"choose-coin-button h4 coin-${coin.cryptoCode.toLowerCase()} ${activeClass}\" data-crypto-code=\"${coin.cryptoCode}\">\n      ${coin.display}\n      <span class=\"choose-coin-svg-wrapper\">\n        <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"52\" height=\"8\" viewBox=\"0 0 52 8\">\n          <path fill=\"none\" fill-rule=\"evenodd\" stroke=\"#FFF\" stroke-linecap=\"round\" stroke-width=\"8\" d=\"M4 4h44\"/>\n        </svg>\n      </span>\n    </div>`\n    $('.crypto-buttons').append(el)\n  })\n  if (showMoreButton) {\n    $('.crypto-buttons').append(`\n      <div class=\"choose-coin-button h4\" data-more=\"true\">\n        <div id=\"crypto-dropdown-toggle\" data-more=\"true\">\n          <span class=\"js-i18n\">${translate('More')}</span>\n          <span class=\"choose-coin-svg-wrapper\">\n            <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"52\" height=\"8\" viewBox=\"0 0 52 8\">\n              <path fill=\"none\" fill-rule=\"evenodd\" stroke=\"#FFF\" stroke-linecap=\"round\" stroke-width=\"8\" d=\"M4 4h44\"/>\n            </svg>\n          </span>\n        </div>\n        <div id=\"cryptos\" class=\"dropdown hide\"></div>\n      </div>\n    `)\n    dropdownCoins.forEach(coin => {\n      const el = `<button class=\"h4 sapphire button small-action-button coin-${coin.cryptoCode.toLowerCase()}\"\n        data-crypto-code=\"${coin.cryptoCode}\">${coin.display}</button>`\n      $('#cryptos').append(el)\n    })\n    const el = `<button class=\"h4 sapphire button small-action-button js-i18n\" data-less=\"true\">${translate('Less')}</button>`\n    $('#cryptos').append(el)\n    // As we add buttons 'more' and 'less' after initTranslate\n    // they don't have baseTranslation translation data attached to them.\n    $('.crypto-buttons .js-i18n').each(function () {\n      var el = $(this)\n      el.data('baseTranslation', el.html().trim())\n    })\n  }\n}\n\nfunction setCryptoBuy (coin) {\n  const cashIn = $('.cash-in')\n  const translatedCoin = translate(coin.display)\n  const buyStr = translate('Buy<br/>%s', [translatedCoin])\n\n  cashIn.html(buyStr)\n}\n\nfunction setCryptoSell (coin) {\n  const cashOut = $('.cash-out')\n  const translatedCoin = translate(coin.display)\n  const sellStr = translate('Sell<br/>%s', [translatedCoin])\n\n  cashOut.html(sellStr)\n}\n\nfunction setCoins (supportedCoins) {\n  coins = supportedCoins\n}\n\nfunction getCryptoCurrency (cryptoCode) {\n  const cryptoCurrency = coins.find(c => c.cryptoCode === cryptoCode)\n  if (!cryptoCurrency) throw new Error(`Unsupported crypto: ${cryptoCode}`)\n  return cryptoCurrency\n}\n\nfunction switchCoin (coin) {\n  const cashIn = $('.cash-in')\n  const cashOut = $('.cash-out')\n  const cryptoCode = coin.cryptoCode\n\n  if (currentCryptoCode === cryptoCode) return\n\n  $(`.coin-${currentCryptoCode.toLowerCase()}`).removeClass('choose-coin-button-active')\n  $(`.coin-${cryptoCode.toLowerCase()}`).addClass('choose-coin-button-active')\n  currentCryptoCode = cryptoCode\n  currentCoin = coin\n\n  cashIn.addClass('crypto-switch')\n  setTimeout(() => setCryptoBuy(coin), 100)\n  setTimeout(() => cashIn.removeClass('crypto-switch'), 1000)\n\n  setTimeout(() => {\n    cashOut.addClass('crypto-switch')\n    setTimeout(() => setCryptoSell(coin), 100)\n    setTimeout(() => cashOut.removeClass('crypto-switch'), 1000)\n  }, 80)\n\n  const selectedIndex = currentCoins.indexOf(currentCoins.find(it => it.cryptoCode === cryptoCode))\n  if (currentCoins.length > 4 && selectedIndex > 2) {\n    currentCoins.splice(2, 0, currentCoins.splice(selectedIndex, 1)[0])\n  }\n\n  setupCoinsButtons()\n}\n\n$(document).ready(function () {\n  const attachFastClick = Origami.fastclick\n  attachFastClick(document.body)\n\n  window.addEventListener('resize', () => {\n    calculateAspectRatio()\n    setChooseCoinColors()\n  })\n\n  // Matt's anti-drag hack\n  window.onclick =\n    window.oncontextmenu =\n      window.onmousedown =\n        window.onmousemove =\n          window.onmouseup =\n            function () { return false }\n\n  BigNumber.config({ ROUNDING_MODE: BigNumber.ROUND_HALF_EVEN })\n\n  wifiKeyboard = new Keyboard({\n    id: 'wifi-keyboard',\n    inputBox: '#input-passphrase'\n  }).init()\n\n  promoKeyboard = new Keyboard({\n    id: 'promo-keyboard',\n    inputBox: '.promo-code-input'\n  }).init(function () {\n    if (currentState !== 'insert_promo_code') return\n    buttonPressed('cancelPromoCode')\n  })\n\n  usSsnKeypad = new Keypad('us-ssn-keypad', { type: 'usSsn' }, function (result) {\n    if (currentState !== 'register_us_ssn') return\n    buttonPressed('usSsn', result)\n  })\n\n  phoneKeypad = new Keypad('phone-keypad', { type: 'phoneNumber', country: 'US' }, function (result) {\n    if (currentState !== 'register_phone') return\n    buttonPressed('phoneNumber', result)\n  })\n\n  securityKeypad = new Keypad('security-keypad', { type: 'code' }, function (result) {\n    if (currentState !== 'security_code') return\n    buttonPressed('securityCode', result)\n  })\n\n  customRequirementNumericalKeypad = new Keypad('custom-requirement-numeric-keypad', {\n    type: 'custom'\n  }, function (result) {\n    if (currentState !== 'custom_permission_screen2_numerical') return\n    buttonPressed('customInfoRequestSubmit', result)\n  })\n\n  customRequirementTextKeyboard = new Keyboard({\n    id: 'custom-requirement-text-keyboard',\n    inputBox: 1,\n    submitButtonWrapper: '.submit-text-requirement-button-wrapper',\n    setComplianceTimeout: setComplianceTimeout\n  }).init(function () {\n    if (currentState !== 'custom_permission_screen2_text') return\n    buttonPressed('customInfoRequestSubmit')\n  })\n\n  customRequirementChoiceList = new ChoiceList({\n    id: 'custom-requirement-choicelist-wrapper',\n    setComplianceTimeout: setComplianceTimeout\n  }).init(function (result) {\n    if (currentState !== 'custom_permission_screen2_choiceList') return\n    buttonPressed('customInfoRequestSubmit', result)\n  })\n\n  if (DEBUG_MODE !== 'demo') {\n    connect()\n    setInterval(verifyConnection, 1000)\n  }\n\n  initTranslatePage()\n\n  var wifiNetworkButtons = document.getElementById('networks')\n  touchEvent(wifiNetworkButtons, function (e) {\n    var target = $(e.target)\n    if (target.attr('id') === 'more-networks') {\n      moreNetworks()\n    } else {\n      var networkButton = target.closest('.wifi-network-button')\n      $('#networks > .active').removeClass('active')\n      networkButton.addClass('active')\n      window.setTimeout(function () { networkButton.removeClass('active') }, 1000)\n      var ssidEl = networkButton.find('.ssid')\n      var ssid = ssidEl.data('ssid')\n      if (ssid) {\n        var displaySsid = ssidEl.text()\n        var rawSsid = ssidEl.data('raw-ssid')\n        buttonPressed('wifiSelect',\n          { ssid: ssid, rawSsid: rawSsid, displaySsid: displaySsid })\n      }\n    }\n  })\n\n  var wifiConnectButton = document.getElementById('wifiConnect')\n  touchEvent(wifiConnectButton, function () {\n    var wifiConnectButtonJ = $(wifiConnectButton)\n    wifiConnectButtonJ.addClass('active')\n    window.setTimeout(function () { wifiConnectButtonJ.removeClass('active') }, 500)\n    var pass = $('#wifi-keyboard input.passphrase').data('content')\n    var ssid = $('#js-i18n-wifi-for-ssid').data('ssid')\n    var rawSsid = $('#js-i18n-wifi-for-ssid').data('raw-ssid')\n    buttonPressed('wifiConnect', { pass: pass, ssid: ssid, rawSsid: rawSsid })\n  })\n\n  var sendCoinsButton = document.getElementById('send-coins')\n  var sendCoinsButton2 = document.getElementById('send-only-send-coins')\n  touchEvent(sendCoinsButton, function () {\n    setState('sending_coins')\n    buttonPressed('sendCoins')\n  })\n\n  touchEvent(sendCoinsButton2, function () {\n    setState('sending_coins')\n    buttonPressed('sendCoins')\n  })\n\n  setupButton('recycler-continue-start', 'recyclerContinue')\n  setupButton('recycler-continue', 'recyclerContinue')\n  setupButton('recycler-finish', 'sendCoins')\n\n  const blockedCustomerOk = document.getElementById('blocked-customer-ok')\n  touchEvent(blockedCustomerOk, function () {\n    buttonPressed('blockedCustomerOk')\n  })\n  var insertBillCancelButton = document.getElementById('insertBillCancel')\n  touchImmediateEvent(insertBillCancelButton, null, function () {\n    setBuyerAddress(null)\n    buttonPressed('cancelInsertBill')\n  })\n\n  var insertBillCancelRecyclerButton = document.getElementById('insertBillCancelRecycler')\n  touchImmediateEvent(insertBillCancelRecyclerButton, function () {\n    setBuyerAddress(null)\n    buttonPressed('cancelInsertBill')\n  })\n\n  setupImmediateButton('wifiPassCancel', 'cancelWifiPass')\n  setupImmediateButton('scanCancel', 'cancelScan')\n  enableViewportButtonEvents()\n  setupImmediateButton('chooseFiatCancel', 'chooseFiatCancel')\n  setupImmediateButton('depositCancel', 'depositCancel')\n  setupImmediateButton('printer-scan-cancel', 'cancelScan')\n\n  setupButton('printer-back-to-home', 'idle')\n  setupButton('printer-print-again', 'printAgain')\n  setupButton('printer-print-again2', 'printAgain')\n  setupButton('printer-scan-again', 'printerScanAgain')\n\n  setupButton('insert-first-bill-promo-button', 'insertPromoCode')\n  setupButton('insert-first-recycler-bills-promo-button', 'insertPromoCode')\n  setupButton('choose-fiat-promo-button', 'insertPromoCode')\n\n  var promoCodeCancelButton = document.getElementById('promo-code-cancel')\n  touchImmediateEvent(promoCodeCancelButton, null, function () {\n    promoKeyboard.deactivate.bind(promoKeyboard)\n    buttonPressed('cancelPromoCode')\n  })\n\n  var submitCodeButton = document.getElementById('submit-promo-code')\n  touchEvent(submitCodeButton, function () {\n    promoKeyboard.deactivate.bind(promoKeyboard)\n    var code = $('.promo-code-input').data('content')\n    buttonPressed('submitPromoCode', { input: code })\n  })\n\n  const submitTextRequirementButton = document.getElementById('submit-text-requirement')\n  const nextFieldTextRequirementButton = document.getElementById('next-text-requirement')\n  const previousFieldTextRequirementButton = document.getElementById('previous-text-requirement')\n  touchEvent(submitTextRequirementButton, function () {\n    customRequirementTextKeyboard.deactivate.bind(customRequirementTextKeyboard)\n    const text1 = $('.text-input-field-1').data('content')\n    const text2 = $('.text-input-field-2').data('content') || ''\n    const text3 = $('.text-input-field-3').data('content') || ''\n    const text = [text1, text2, text3].filter(t => t != '').join(' ')\n    buttonPressed('customInfoRequestSubmit', text)\n    $('.text-input-field-1').removeClass('faded').data('content', '').val('')\n    $('.text-input-field-2').addClass('faded').data('content', '').val('')\n    $('.text-input-field-3').addClass('faded').data('content', '').val('')\n    customRequirementTextKeyboard.setInputBox(1)\n  })\n  touchEvent(nextFieldTextRequirementButton, function() {\n    let fieldState = customRequirementTextKeyboard.getInputBox()\n    let finalState = customRequirementTextKeyboardNumberOfBoxes\n\n    $(`.text-input-field-${fieldState}`).addClass('faded')\n    $('#previous-text-requirement').show()\n\n    fieldState = fieldState == finalState ? fieldState : fieldState + 1;\n\n    $(`.text-input-field-${fieldState}`).removeClass('faded')\n    customRequirementTextKeyboard.setInputBox(fieldState, ['#submit-text-requirement'])\n\n    if (fieldState === finalState) {\n      $('#next-text-requirement').hide()\n    }\n  })\n  touchEvent(previousFieldTextRequirementButton, function() {\n    let fieldState = customRequirementTextKeyboard.getInputBox()\n\n    $(`.text-input-field-${fieldState}`).addClass('faded')\n    $('#next-text-requirement').show()\n\n    fieldState = fieldState == 1 ? 1 : fieldState - 1;\n    \n    $(`.text-input-field-${fieldState}`).removeClass('faded')\n\n    customRequirementTextKeyboard.setInputBox(fieldState, ['#next-text-requirement'])\n\n    if (fieldState === 1) {\n      $('#previous-text-requirement').hide()\n    }\n\n  })\n\n  setupButton('submit-promo-code', 'submitPromoCode', {\n    input: $('.promo-code-input').data('content')\n  })\n  setupButton('promo-code-try-again', 'insertPromoCode')\n  setupButton('promo-code-continue', 'cancelPromoCode')\n\n  setupButton('initialize', 'initialize')\n  // setupButton('test-mode', 'testMode')\n  setupButton('pairing-scan', 'pairingScan')\n  setupButton('pairing-scan-cancel', 'pairingScanCancel')\n  setupButton('pairing-error-ok', 'pairingErrorOk')\n  setupButton('cash-out-button', 'cashOut')\n\n  setupImmediateButton('scan-id-cancel', 'idDataActionCancel')\n  setupImmediateButton('scan-photo-cancel', 'idPhotoActionCancel')\n  setupImmediateButton('scan-photo-manual-cancel', 'idPhotoActionCancel')\n  setupImmediateButton('us-ssn-cancel', 'cancelUsSsn',\n    usSsnKeypad.deactivate.bind(usSsnKeypad))\n  setupImmediateButton('phone-number-cancel', 'cancelPhoneNumber',\n    phoneKeypad.deactivate.bind(phoneKeypad))\n  setupImmediateButton('security-code-cancel', 'cancelSecurityCode',\n    securityKeypad.deactivate.bind(securityKeypad))\n  setupButton('id-verification-failed-ok', 'idVerificationFailedOk')\n  setupButton('id-scan-failed-try-again', 'idCodeFailedRetry')\n  setupButton('id-scan-failed-cancel', 'idVerificationFailedOk')\n  setupButton('id-code-failed-retry', 'idCodeFailedRetry')\n  setupButton('id-code-failed-cancel', 'bye')\n  setupButton('id-verification-error-ok', 'idVerificationErrorOk')\n  setupButton('photo-scan-failed-retry', 'retryPhotoScan')\n  setupButton('photo-scan-failed-cancel', 'photoScanVerificationCancel')\n  setupButton('photo-verification-failed-ok', 'cancelIdScan')\n  setupButton('invalid-address-try-again', 'invalidAddressTryAgain')\n  setupButton('address-reuse-start-over', 'idle')\n  setupButton('suspicious-address-start-over', 'idle')\n\n  setupButton('sanctions-failure-ok', 'idle')\n  setupButton('limit-reached-ok', 'idle')\n  setupButton('hard-limit-reached-ok', 'idle')\n  setupButton('deposit-timeout-sent-yes', 'depositTimeout')\n  setupButton('deposit-timeout-sent-no', 'depositTimeoutNotSent')\n  setupButton('out-of-cash-ok', 'idle')\n  setupButton('cash-in-disabled-ok', 'idle')\n  setupButton('cash-in-only-ok', 'idle')\n\n  setupButton('bad-phone-number-ok', 'badPhoneNumberOk')\n  setupButton('bad-security-code-ok', 'badSecurityCodeOk')\n  setupButton('max-phone-retries-ok', 'maxPhoneRetriesOk')\n  setupButton('redeem-later-ok', 'idle')\n  setupButton('pre-receipt-ok', 'fiatReceipt')\n  setupButton('fiat-error-ok', 'idle')\n  setupButton('network-down-ok', 'idle')\n  setupButton('fiat-transaction-error-ok', 'fiatReceipt')\n\n  setupButton('unknown-phone-number-ok', 'idle')\n  setupButton('unconfirmed-deposit-ok', 'idle')\n  setupButton('tx-not-seen-ok', 'idle')\n  setupButton('wrong-dispenser-currency-ok', 'idle')\n\n  setupButton('print-receipt-cash-in-button', 'printReceipt')\n  setupButton('print-receipt-cash-out-button', 'printReceipt')\n  setupButton('print-receipt-cash-in-fail-button', 'printReceipt')\n\n  setupButton('send-sms-receipt-cash-in-button', 'sendSmsReceipt')\n  setupButton('send-sms-receipt-cash-out-button', 'sendSmsReceipt')\n  setupButton('send-sms-receipt-cash-in-fail-button', 'sendSmsReceipt')\n\n  setupButton('terms-ok', 'termsAccepted')\n  setupButton('terms-ko', 'idle')\n  \n  setupImmediateButton('rates-close', 'idle')\n  setupButton('rates-section-button', 'ratesScreen')\n\n  setupButton('maintenance_restart', 'maintenanceRestart')\n\n  calculateAspectRatio()\n\n  const cryptoButtons = document.getElementById('crypto-buttons')\n  touchEvent(cryptoButtons, event => {\n    let el = $(event.target)\n    if (el.is('path') || el.is('svg') || el.is('span')) {\n      el = el.closest('div')\n    }\n\n    if (el.data('more')) {\n      openCoinDropdown()\n      return\n    }\n\n    if (el.data('less')) {\n      closeCoinDropdown()\n      return\n    }\n\n    const cryptoCode = el.data('cryptoCode')\n    if (!cryptoCode) return\n\n    const wantedCoin = currentCoins.find(it => it.cryptoCode === cryptoCode)\n    if (!wantedCoin) return\n\n    const coin = { cryptoCode, display: wantedCoin.display }\n    switchCoin(coin)\n  })\n\n  var areYouSureCancel = document.getElementById('are-you-sure-cancel-transaction')\n  touchEvent(areYouSureCancel, () => buttonPressed('cancelTransaction', previousState))\n\n  var areYouSureContinue = document.getElementById('are-you-sure-continue-transaction')\n  touchEvent(areYouSureContinue, () => buttonPressed('continueTransaction', previousState))\n\n  var coinRedeem = document.getElementById('coin-redeem-button')\n  touchEvent(coinRedeem, () => {\n    setDirection('cashOut')\n    buttonPressed('redeem')\n  })\n\n  setupButton('facephoto-scan-failed-retry', 'retryFacephoto')\n  setupButton('id-start-verification', 'permissionIdCompliance')\n  setupButton('sms-start-verification', 'permissionSmsCompliance')\n  setupButton('ready-to-scan-id-card-photo', 'scanIdCardPhoto')\n  setupButton('facephoto-permission-yes', 'permissionPhotoCompliance')\n  setupButton('us-ssn-permission-yes', 'permissionUsSsnCompliance')\n\n  setupButton('send-coins-id', 'finishBeforeSms')\n  setupButton('send-coins-id-2', 'finishBeforeSms')\n  setupButton('send-coins-sms', 'finishBeforeSms')\n  setupButton('send-coins-sms-2', 'finishBeforeSms')\n\n  setupButton('facephoto-permission-no', 'finishBeforeSms')\n  setupButton('us-ssn-permission-send-coins', 'finishBeforeSms')\n  setupButton('us-ssn-permission-cancel', 'finishBeforeSms')\n  setupButton('us-ssn-cancel', 'finishBeforeSms')\n  setupButton('facephoto-scan-failed-cancel', 'finishBeforeSms')\n  setupButton('facephoto-scan-failed-cancel2', 'finishBeforeSms')\n\n  setupImmediateButton('custom-permission-cancel-choiceList', 'cancelCustomInfoRequest')\n\n  setupButton('custom-permission-yes', 'permissionCustomInfoRequest')\n  setupButton('custom-permission-no', 'finishBeforeSms')\n  setupImmediateButton('custom-permission-cancel-numerical', 'cancelCustomInfoRequest',\n    customRequirementNumericalKeypad.deactivate.bind(customRequirementNumericalKeypad))\n  setupImmediateButton('custom-permission-cancel-text', 'cancelCustomInfoRequest', () => {\n    customRequirementTextKeyboard.deactivate.bind(customRequirementTextKeyboard)()\n    $('.text-input-field-1').removeClass('faded').data('content', '').val('')\n    $('.text-input-field-2').addClass('faded').data('content', '').val('')\n    $('.text-input-field-3').addClass('faded').data('content', '').val('')\n    customRequirementTextKeyboard.setInputBox('.text-input-field-1')\n  })\n\n  touchEvent(document.getElementById('change-language-section'), () => {\n    if (_primaryLocales.length === 2) {\n      setLocale(otherLocale())\n      setCryptoBuy(currentCoin)\n      setCryptoSell(currentCoin)\n      return\n    }\n    openLanguageDropdown()\n  })\n\n  const cashInBox = document.getElementById('cash-in-box')\n  touchEvent(cashInBox, () => {\n    buttonPressed('start', { cryptoCode: currentCryptoCode, direction: 'cashIn' })\n  })\n\n  const cashOutBox = document.getElementById('cash-out-box')\n  touchEvent(cashOutBox, () => {\n    buttonPressed('start', { cryptoCode: currentCryptoCode, direction: 'cashOut' })\n  })\n\n  var languageOverlay = document.getElementById('language-overlay')\n  touchEvent(languageOverlay, function (e) {\n    closeLanguageDropdown()\n  })\n\n  var cryptoOverlay = document.getElementById('crypto-overlay')\n  touchEvent(cryptoOverlay, function (e) {\n    closeCoinDropdown()\n  })\n\n  var languageButtons = document.getElementById('languages')\n  touchEvent(languageButtons, function (e) {\n    var languageButtonJ = $(e.target).closest('button')\n    if (languageButtonJ.length === 0) return\n    var newLocale = languageButtonJ.attr('data-locale')\n\n    if (!newLocale) {\n      closeLanguageDropdown()\n      return\n    }\n\n    setLocale(newLocale)\n    setCryptoBuy(currentCoin)\n    setCryptoSell(currentCoin)\n    closeLanguageDropdown()\n  })\n\n  buildCassetteButtonEvents()\n  initDebug()\n})\n\nfunction disableViewportButtonEvents () {\n  viewportButtonEventsActive = false\n  disableImmediateButton('completed_viewport', 'completed')\n  disableImmediateButton('withdraw_failure_viewport', 'completed')\n  disableImmediateButton('out_of_coins_viewport', 'completed')\n  disableImmediateButton('fiat_receipt_viewport', 'completed')\n  disableImmediateButton('fiat_complete_viewport', 'completed')\n}\n\nfunction enableViewportButtonEvents () {\n  viewportButtonEventsActive = true\n  setupImmediateButton('completed_viewport', 'completed')\n  setupImmediateButton('withdraw_failure_viewport', 'completed')\n  setupImmediateButton('out_of_coins_viewport', 'completed')\n  setupImmediateButton('fiat_receipt_viewport', 'completed')\n  setupImmediateButton('fiat_complete_viewport', 'completed')\n}\n\nfunction targetButton (element) {\n  var classList = element.classList || []\n  var special = classList.contains('button') ||\n    classList.contains('circle-button') ||\n    classList.contains('wifi-network-button') ||\n    classList.contains('square-button')\n  if (special) { return element }\n  return targetButton(element.parentNode)\n}\n\nfunction touchEvent (element, callback) {\n  function handler (e) {\n    var target = targetButton(e.target)\n\n    target.classList.add('active')\n\n    // Wait for transition to finish\n    setTimeout(function () {\n      target.classList.remove('active')\n    }, 300)\n\n    setTimeout(function () {\n      callback(e)\n    }, 200)\n\n    e.stopPropagation()\n    e.preventDefault()\n  }\n\n  if (shouldEnableTouch()) {\n    element.addEventListener('touchstart', handler)\n  }\n  element.addEventListener('mousedown', handler)\n}\n\nfunction touchImmediateEvent (element, action, callback) {\n  function handler (e) {\n    callback(e)\n    e.stopPropagation()\n    e.preventDefault()\n  }\n\n  // Viewport events need to be disabled to improve UX in some cases. e.g. Not allowing to finish the transaction while a receipt is being printed\n  // To remove event listeners, the exact same function reference needs to be provided to removeEventListener().\n  // As such, the reference to the exact handler function needs to be saved to be called when disabling it, hence the need for viewportEvents\n  // As the same element can have different actions hooked on the same event, this needs to be stored as an array of <action, handler> pairs\n\n  // The viewportButtonEventsActive ensures that no repeated events are being added to the element\n  if (action && element.id.includes('_viewport')) {\n    if (!viewportEvents[element.id]) viewportEvents[element.id] = []\n    viewportEvents[element.id].push({ action, handler })\n  }\n\n  if (shouldEnableTouch()) {\n    element.addEventListener('touchstart', handler)\n  }\n  element.addEventListener('mousedown', handler)\n}\n\nfunction setupImmediateButton (buttonClass, buttonAction, callback) {\n  var button = document.getElementById(buttonClass)\n  touchImmediateEvent(button, buttonAction, function () {\n    if (callback) callback()\n    buttonPressed(buttonAction)\n  })\n}\n\nfunction disableTouchImmediateEvent(element, action) {\n  if (shouldEnableTouch()) {\n    element.removeEventListener('touchstart', viewportEvents[element.id].find(it => it.action === action).handler)\n  }\n  element.removeEventListener('mousedown', viewportEvents[element.id].find(it => it.action === action).handler)\n\n  // Trim the viewportEvents obj\n  viewportEvents[element.id] = viewportEvents[element.id].filter(it => it.action !== action)\n}\n\nfunction disableImmediateButton(buttonClass, buttonAction, callback) {\n  var button = document.getElementById(buttonClass)\n  disableTouchImmediateEvent(button, buttonAction, function () {\n    if (callback) callback()\n    buttonPressed(buttonAction)\n  })\n}\n\nfunction setupButton (buttonClass, buttonAction, actionData) {\n  var button = document.getElementById(buttonClass)\n  touchEvent(button, function () {\n    buttonPressed(buttonAction, actionData)\n  })\n}\n\nfunction setScreen (newScreen, oldScreen) {\n  if (newScreen === oldScreen) return\n\n  if (newScreen === 'insert_bills') {\n    $('.js-processing-bill').html(translate('Lamassu Cryptomat'))\n    $('.bill img').css({'-webkit-transform': 'none', top: 0, left: 0})\n  }\n\n  var newView = $('.' + newScreen + '_state')\n  if (newView.length !== 1) console.log('FATAL: ' + newView.length + ' screens found of class ' + newScreen + '_state')\n\n  $('.viewport').removeClass('viewport-active')\n  newView.addClass('viewport-active')\n}\n\nfunction setState (state, delay) {\n  if (state === currentState) return\n\n  if (currentState === 'terms_screen') {\n    clearTermsConditionsTimeout()\n    clearTermsConditionsAcceptanceDelay()\n  }\n\n  setComplianceTimeout(0)\n\n  previousState = currentState\n  currentState = state\n\n  wifiKeyboard.reset()\n  promoKeyboard.reset()\n  customRequirementTextKeyboard.reset()\n\n  if (state === 'idle') {\n    $('.qr-code').empty()\n    $('.qr-code-deposit').empty()\n  }\n\n  if (delay) {\n    window.setTimeout(function () {\n      setScreen(currentState, previousState)\n    }, delay)\n  } else setScreen(currentState, previousState)\n}\n\nfunction revertScreen () { setScreen(currentState) }\n\nfunction setWifiList (recs, requestedPage) {\n  var networks = $('#networks')\n  if (!recs) recs = networks.data('recs')\n  var page = requestedPage || networks.data('page') || 0\n  var offset = page * 4\n  if (offset > recs.length - 1) {\n    offset = 0\n    page = 0\n  }\n  $('#more-networks').css({ 'display': 'none' })\n  networks.empty()\n  networks.data('page', page)\n  networks.data('recs', recs)\n  var remainingCount = recs.length - offset\n  var len = Math.min(remainingCount, 4)\n  for (var i = 0; i < len; i++) {\n    var rec = recs[i + offset]\n    var bars = Math.floor(rec.strength * 4) + 1\n    var html = '<div class=\"wifi-network-button filled-action-button tl2\">' +\n    '<span class=\"ssid\" data-raw-ssid=\"' + rec.rawSsid + '\" data-ssid=\"' +\n      rec.ssid + '\">' + rec.displaySsid +\n    '</span>' + '<div class=\"wifiicon-wrapper\"><img src=\"images/wifiicon/' + bars + '.svg\"/></div></div>'\n    networks.append(html)\n  }\n\n  var moreTxt = translate('MORE')\n  var button = '<span display=\"inline-block\" id=\"more-networks\" class=\"button filled-action-button tl2\">' + moreTxt + '</span>'\n  if (recs.length > 4) {\n    networks.append(button)\n  }\n}\n\nfunction setUpDirectionElement (element, direction) {\n  if (direction === 'cashOut') {\n    element.removeClass('cash-in-color')\n    element.addClass('cash-out-color')\n  } else {\n    element.addClass('cash-in-color')\n    element.removeClass('cash-out-color')\n  }\n}\n\nfunction setOperatorInfo (operator) {\n  if (!operator || !operator.active) {\n    $('.contacts, .contacts-compact').addClass('hide')\n  } else {\n    $('.contacts, .contacts-compact').removeClass('hide')\n    $('.operator-name').text(operator.name)\n    $('.operator-email').text(operator.email)\n    $('.operator-phone').text(operator.phone)\n  }\n}\n\nfunction setHardLimit (limits) {\n  const component = $('#hard-limit-hours')\n  if (limits.hardLimitWeeks >= 1) {\n    return component.text(translate('Please come back in %s weeks', [limits.hardLimitWeeks]))\n  }\n\n  if (limits.hardLimitDays >= 1) {\n    return component.text(translate('Please come back in %s days and %s hours', [limits.hardLimitDays, limits.hardLimitHours]))\n  }\n\n  component.text(translate('Please come back in %s hours', [limits.hardLimitHours]))\n}\n\nfunction setCryptomatModel (model) {\n  cryptomatModel = model\n  const versions = ['sintra', 'douro', 'gaia', 'tejo']\n  const body = $('body')\n\n  versions.forEach(it => body.removeClass(it))\n  $('body').addClass(model.startsWith('douro') ? 'douro' : model)\n}\n\nfunction enableRecyclerBillButtons() {\n  var continueButton = document.getElementById('recycler-continue');\n  var finishButton = document.getElementById('recycler-finish');\n  continueButton.disabled = false;\n  finishButton.disabled = false;\n}\n\nfunction disableRecyclerBillButtons() {\n  var continueButton = document.getElementById('recycler-continue');\n  var finishButton = document.getElementById('recycler-finish');\n  continueButton.disabled = true;\n  finishButton.disabled = true;\n}\n\nfunction setDirection (direction) {\n  let states = [\n    $('.scan_id_photo_state'),\n    $('.scan_manual_id_photo_state'),\n    $('.scan_id_data_state'),\n    $('.security_code_state'),\n    $('.register_us_ssn_state'),\n    $('.us_ssn_permission_state'),\n    $('.register_phone_state'),\n    $('.terms_screen_state'),\n    $('.verifying_id_photo_state'),\n    $('.verifying_face_photo_state'),\n    $('.verifying_id_data_state'),\n    $('.permission_id_state'),\n    $('.sms_verification_state'),\n    $('.bad_phone_number_state'),\n    $('.bad_security_code_state'),\n    $('.max_phone_retries_state'),\n    $('.failed_permission_id_state'),\n    $('.failed_verifying_id_photo_state'),\n    $('.blocked_customer_state'),\n    $('.fiat_error_state'),\n    $('.fiat_transaction_error_state'),\n    $('.failed_scan_id_data_state'),\n    $('.sanctions_failure_state'),\n    $('.error_permission_id_state'),\n    $('.scan_face_photo_state'),\n    $('.retry_scan_face_photo_state'),\n    $('.permission_face_photo_state'),\n    $('.failed_scan_face_photo_state'),\n    $('.hard_limit_reached_state'),\n    $('.failed_scan_id_photo_state'),\n    $('.retry_permission_id_state'),\n    $('.waiting_state'),\n    $('.insert_promo_code_state'),\n    $('.promo_code_not_found_state'),\n    $('.custom_permission_state'),\n    $('.custom_permission_screen2_numerical_state'),\n    $('.custom_permission_screen2_text_state'),\n    $('.custom_permission_screen2_choiceList_state')\n  ]\n  states.forEach(it => {\n    setUpDirectionElement(it, direction)\n  })\n}\n\n/**\n *\n * @param {Object} data\n * @param {boolean} data.active\n * @param {String} data.title\n * @param {String} data.text\n * @param {String} data.accept\n * @param {String} data.cancel\n */\nfunction setTermsScreen (data) {\n  const $screen = $('.terms_screen_state')\n  $screen.find('.js-terms-title').html(data.title)\n  startPage(data.text, data.acceptDisabled)\n  $screen.find('.js-terms-cancel-button').html(data.cancel)\n  $screen.find('.js-terms-accept-button').html(data.accept)\n  setTermsConditionsTimeout()\n  setAcceptButtonDisabled($screen, data)\n  setTermsConditionsAcceptanceDelay($screen, data)\n}\n\nfunction setAcceptButtonDisabled (screen, data) {\n  var acceptButton = screen.find('.js-terms-accept-button');\n  acceptButton.prop('disabled', Boolean(data.acceptDisabled));\n}\n\nfunction clearTermsConditionsTimeout () {\n  clearTimeout(termsConditionsTimeout)\n}\n\nfunction setTermsConditionsTimeout () {\n  termsConditionsTimeout = setTimeout(function () {\n    if (currentState === 'terms_screen') {\n      buttonPressed('idle')\n    }\n  }, T_C_TIMEOUT)\n}\n\nfunction setTermsConditionsAcceptanceDelay (screen, data) {\n  let acceptButton = screen.find('.js-terms-accept-button')\n  acceptButton.css({ 'min-width': 0 })\n\n  if (!data.delay) return\n\n  const delayTimer = isNaN(data.delayTimer) ? 0 : data.delayTimer\n  let seconds = delayTimer / 1000\n  acceptButton.prop('disabled', true)\n  acceptButton.html(seconds > 0 ? `${data.accept} (${seconds})` : `${data.accept}`)\n\n  var tmpbtn = acceptButton.clone().appendTo('body').css({ 'display': 'block', 'visibility': 'hidden' })\n  var width = tmpbtn.outerWidth()\n  tmpbtn.remove()\n  acceptButton.css({ 'min-width': `${width}px` })\n  termsConditionsAcceptanceInterval = setInterval(function () {\n    seconds--\n    if (currentState === 'terms_screen' && seconds > 0) {\n      acceptButton.html(`${data.accept} (${seconds})`)\n    }\n    if (currentState === 'terms_screen' && seconds <= 0) {\n      acceptButton.prop('disabled', false)\n      acceptButton.html(`${data.accept}`)\n    }\n    if (seconds <= 0) {\n      clearInterval(termsConditionsAcceptanceInterval)\n    }\n  }, 1000)\n}\n\nfunction clearTermsConditionsAcceptanceDelay () {\n  clearInterval(termsConditionsAcceptanceInterval)\n  clearTimeout(termsConditionsAcceptanceTimeout)\n}\n\nfunction resetTermsConditionsTimeout () {\n  clearTermsConditionsTimeout()\n  setTermsConditionsTimeout()\n}\n\n// click page up button\nfunction scrollUp () {\n  resetTermsConditionsTimeout()\n  const div = document.getElementById('js-terms-text-div')\n  if (currentPage !== 0) {\n    currentPage -= 1\n    updateButtonStyles()\n    updatePageCounter()\n    div.scrollTo(0, currentPage * scrollSize)\n  }\n}\n\n// start page\nfunction startPage (text, acceptedTerms) {\n  const $screen = $('.terms_screen_state')\n  $screen.find('.js-terms-text').html(text)\n  if (!acceptedTerms) currentPage = 0\n  totalPages = 0\n  setTimeout(function () {\n    const div = document.getElementById('js-terms-text-div')\n    textHeightQuantity = document.getElementById('js-terms-text').offsetHeight\n    scrollSize = div.offsetHeight - 40\n    updateButtonStyles()\n    if (text.length <= 1000 && textHeightQuantity <= div.offsetHeight) {\n      document.getElementById('actions-scroll').style.display = 'none'\n    } else {\n      document.getElementById('actions-scroll').style.display = ''\n      if (!acceptedTerms) div.scrollTo(0, 0)\n      totalPages = Math.ceil(textHeightQuantity / scrollSize)\n      updatePageCounter()\n    }\n  }, 100)\n}\n\nfunction updatePageCounter () {\n  document.getElementById('terms-page-counter').textContent = `${currentPage + 1}/${totalPages}`\n}\n\n// click page up button\nfunction scrollDown () {\n  resetTermsConditionsTimeout()\n  const div = document.getElementById('js-terms-text-div')\n  if (!(currentPage * scrollSize + scrollSize > textHeightQuantity && currentPage !== 0)) {\n    currentPage += 1\n    updateButtonStyles()\n    updatePageCounter()\n    div.scrollTo(0, currentPage * scrollSize)\n  }\n}\n\nfunction updateButtonStyles () {\n  textHeightQuantity = document.getElementById('js-terms-text').offsetHeight\n  const buttonDown = document.getElementById('scroll-down')\n  const buttonUp = document.getElementById('scroll-up')\n  if (currentPage === 0) {\n    buttonUp.disabled = true\n  } else {\n    buttonUp.disabled = false\n  }\n\n  if (currentPage * scrollSize + scrollSize > textHeightQuantity && currentPage !== 0) {\n    buttonDown.disabled = true\n  } else {\n    buttonDown.disabled = false\n  }\n}\n\nfunction moreNetworks () {\n  var networks = $('#networks')\n  var page = networks.data('page')\n  setWifiList(null, page + 1)\n}\n\nfunction setWifiSsid (data) {\n  $('#js-i18n-wifi-for-ssid').data('ssid', data.ssid)\n  $('#js-i18n-wifi-for-ssid').data('raw-ssid', data.rawSsid)\n  t('wifi-for-ssid', translate('for %s', ['<strong>' + data.ssid + '</strong>']))\n  t('wifi-connect', translate(\"You're connecting to the WiFi network %s\", ['<strong>' + data.ssid + '</strong>']))\n}\n\nfunction setLocaleInfo (data) {\n  phoneKeypad.setCountry(data.country)\n  setPrimaryLocales(data.primaryLocales)\n  setLocale(data.primaryLocale)\n}\n\nfunction otherLanguageName () {\n  const lang = lookupLocaleNames(otherLocale())\n  return lang && lang.nativeName\n}\n\nfunction otherLocale () {\n  return _primaryLocales.find(c => c !== localeCode)\n}\n\nfunction setLocale (data) {\n  if (!data || data === localeCode) return\n  localeCode = data\n  jsLocaleCode = data\n  var lang = localeCode.split('-')[0]\n\n  if (jsLocaleCode === 'fr-QC') jsLocaleCode = 'fr-CA'\n\n  var isArabic = jsLocaleCode.indexOf('ar-') === 0\n  var isHebrew = jsLocaleCode.indexOf('he-') === 0\n  isRTL = isArabic || isHebrew\n\n  setChooseCoinColors()\n  // setupAnimation(isTwoWay, aspectRatio800)\n\n  if (isRTL) {\n    $('body').addClass('i18n-rtl')\n  } else {\n    $('body').removeClass('i18n-rtl')\n  }\n\n  if (isArabic) {\n    $('body').addClass('i18n-ar')\n  } else {\n    $('body').removeClass('i18n-ar')\n  }\n\n  if (isHebrew) {\n    $('body').addClass('i18n-he')\n  } else {\n    $('body').removeClass('i18n-he')\n  }\n\n  if (MUSEO.indexOf(lang) !== -1) $('body').addClass('museo')\n  else $('body').removeClass('museo')\n\n  locale = loadI18n(localeCode)\n  try { translatePage() } catch (ex) {}\n\n  $('.js-two-language').html(otherLanguageName())\n\n  if (lastRates) setExchangeRate(lastRates)\n}\n\nfunction setChooseCoinColors () {\n  var elem = $('#bg-to-show > img')\n  let img = `images/background/${isTwoWay ? '2way' : '1way'}-${aspectRatio}${isRTL ? '-rtl' : ''}.svg`\n  if (img !== elem.attr('src')) {\n    elem.attr('src', img)\n  }\n\n  if (isTwoWay) {\n    $('.choose_coin_state .change-language').removeClass('cash-in-color').addClass('cash-out-color')\n    $('.choose_coin_state #rates-section').removeClass('cash-in-color').addClass('cash-out-color')\n  } else {\n    $('.choose_coin_state .change-language').removeClass('cash-out-color').addClass('cash-in-color')\n    $('.choose_coin_state #rates-section').removeClass('cash-out-color').addClass('cash-in-color')\n  }\n}\n\nfunction areArraysEqual (arr1, arr2) {\n  if (arr1.length !== arr2.length) return false\n  for (var i = 0; i < arr1.length; i++) {\n    if (arr1[i] !== arr2[i]) return false\n  }\n  return true\n}\n\nfunction lookupLocaleNames (locale) {\n  if (!locale) return\n  var langMap = window.languageMappingList\n  var language = locale.split('-')[0]\n  var localeNames = langMap[language]\n  return localeNames || langMap[locale]\n}\n\nfunction setPrimaryLocales (primaryLocales) {\n  if (areArraysEqual(primaryLocales, _primaryLocales)) return\n  _primaryLocales = primaryLocales\n\n  var languages = $('#languages')\n  closeLanguageDropdown()\n  languages.empty()\n  var sortedPrimaryLocales = primaryLocales.filter(lookupLocaleNames).sort(function (a, b) {\n    var langA = lookupLocaleNames(a)\n    var langB = lookupLocaleNames(b)\n    return langA.englishName.localeCompare(langB.englishName)\n  })\n\n  languages.append(`<button class=\"square-button small-action-button tl2\">Languages</button>`)\n  for (var i = 0; i < sortedPrimaryLocales.length; i++) {\n    var l = sortedPrimaryLocales[i]\n    var lang = lookupLocaleNames(l)\n    var name = lang.nativeName || lang.englishName\n    var div = `<button class=\"square-button small-action-button tl2\" data-locale=\"${l}\">${name}</button>`\n    languages.append(div)\n  }\n\n  $('.js-two-language').html(otherLanguageName())\n\n  $('.js-menu-language').toggleClass('hide', sortedPrimaryLocales.length <= 1)\n  $('.js-multi-language').toggleClass('hide', sortedPrimaryLocales.length === 2)\n  $('.js-two-language').toggleClass('hide', sortedPrimaryLocales.length > 2)\n}\n\nfunction setFiatCode (data) {\n  fiatCode = data\n  $('.js-currency').text(fiatCode)\n}\n\nfunction setFixedFee (_fee) {\n  const fee = parseFloat(_fee)\n  if (fee > 0) {\n    const fixedFee = translate('Transaction Fee: %s', [formatFiat(fee, 2)])\n    $('.js-i18n-fixed-fee').html(fixedFee)\n  } else {\n    $('.js-i18n-fixed-fee').html('')\n  }\n}\n\nfunction setCredit (credit, lastBill) {\n  const { fiat, cryptoAtoms, cryptoCode } = credit\n  var coin = getCryptoCurrency(cryptoCode)\n\n  var scale = new BigNumber(10).pow(coin.displayScale)\n  var cryptoAmount = new BigNumber(cryptoAtoms).div(scale).toNumber()\n  var cryptoDisplayCode = coin.displayCode\n  updateCrypto('.total-crypto-rec', cryptoAmount, cryptoDisplayCode)\n  $('.amount-deposited').html(translate('You deposited %s', [`${fiat} ${fiatCode}`]))\n  $('.fiat .js-amount').html(fiat)\n\n  var inserted = lastBill\n    ? translate('You inserted a %s bill', [formatFiat(lastBill)])\n    : translate('Lamassu Cryptomat')\n\n  $('.js-processing-bill').html(inserted)\n\n  $('.js-continue-crypto-enable').show()\n  $('.js-send-crypto-enable').show()\n}\n\nfunction formatDenomination (denom) {\n  return denom.toLocaleString(jsLocaleCode, {\n    useGrouping: true,\n    maximumFractionDigits: 0,\n    minimumFractionDigits: 0\n  })\n}\n\nfunction buildCassetteButtons (_cassettes, numberOfButtons) {\n  cassettes = _cassettes\n\n  _cassettes = _cassettes.map(c => {\n    const isVirtual = c.count === null\n    const isActive = isVirtual || c.count > 0\n    return Object.assign(c, { isVirtual, isActive })\n  })\n\n  let [virtualCassettes, physicalCassettes] = partitionBy(_cassettes, it => it.isVirtual)\n\n  physicalCassettes = Object.entries(groupBy(physicalCassettes, c => c.denomination))\n    .map(([denomination, arr]) => {\n      const count = sumBy(arr, x => x.count)\n      const isActive = count > 0\n      return { denomination, count, isActive }\n    })\n\n  const [activeCassettes, inactiveCassettes] = partitionBy(physicalCassettes, it => it.isActive)\n\n  _cassettes = activeCassettes\n    .concat(virtualCassettes, inactiveCassettes)\n    .slice(0, numberOfButtons)\n    .sort((a, b) => a.denomination - b.denomination)\n\n  for (var i = 0; i < _cassettes.length; i++) {\n    var denomination = formatDenomination(_cassettes[i].denomination || 0)\n    $('.cash-button[data-denomination-index=' + i + '] .js-denomination').text(denomination)\n  }\n}\n\nfunction updateCassetteButtons (activeDenoms, numberOfButtons) {\n  for(var i = 0; i < numberOfButtons; i++) {\n    var button = $('.choose_fiat_state .cash-button[data-denomination-index=' + i + ']')\n    var denomination = button.children('.js-denomination').text()\n    button.prop('disabled', !Boolean(activeDenoms[denomination]))\n  }\n}\n\nfunction buildCassetteButtonEvents () {\n  var fiatButtons = document.getElementById('js-fiat-buttons')\n  var lastTouch = null\n\n  touchImmediateEvent(fiatButtons, null, function (e) {\n    var now = Date.now()\n    if (lastTouch && now - lastTouch < 100) return\n    lastTouch = now\n    var cashButtonJ = $(e.target).closest('.cash-button')\n    if (cashButtonJ.length === 0) return\n    if (cashButtonJ.hasClass('disabled')) return\n    if (cashButtonJ.hasClass('clear')) return buttonPressed('clearFiat')\n    buttonPressed('fiatButton', { denomination: cashButtonJ.children('.js-denomination').text() })\n  })\n}\n\nfunction updateCrypto (selector, cryptoAmount, cryptoDisplayCode) {\n  $(selector).find('.crypto-amount').html(formatCrypto(cryptoAmount))\n  $(selector).find('.crypto-units').html(cryptoDisplayCode)\n}\n\nfunction lookupDecimalChar (localeCode) {\n  var num = 1.1\n  var localized = num.toLocaleString(jsLocaleCode, {\n    useGrouping: true,\n    maximumFractionDigits: 1,\n    minimumFractionDigits: 1\n  })\n\n  return localized[1]\n}\n\nfunction splitNumber (localize, localeCode) {\n  var decimalChar = lookupDecimalChar(localeCode)\n  var split = localize.split(decimalChar)\n\n  if (split.length === 1) {\n    return ['<span class=\"integer\">', split[0], '</span>'].join('')\n  }\n\n  return [\n    '<span class=\"integer\">', split[0], '</span><span class=\"decimal-char\">',\n    decimalChar, '</span><span class=\"decimal\">', split[1], '</span>'\n  ].join('')\n}\n\nfunction formatNumber (num) {\n  var localized = num.toLocaleString(jsLocaleCode, {\n    useGrouping: true,\n    maximumFractionDigits: 6,\n    minimumFractionDigits: 3\n  })\n\n  return splitNumber(localized, jsLocaleCode)\n}\n\nfunction formatCrypto (amount) {\n  return formatNumber(amount)\n}\n\nfunction formatFiat (amount, fractionDigits) {\n  if (!fractionDigits) fractionDigits = 0\n\n  const localized = amount.toLocaleString(jsLocaleCode, {\n    useGrouping: true,\n    maximumFractionDigits: fractionDigits,\n    minimumFractionDigits: fractionDigits\n  })\n  return splitNumber(localized, jsLocaleCode) + ' ' + fiatCode\n}\n\nfunction setExchangeRate (_rates) {\n  lastRates = _rates\n  var cryptoCode = _rates.cryptoCode\n  var rates = _rates.rates\n\n  var coin = getCryptoCurrency(cryptoCode)\n  var displayCode = coin.displayCode\n\n  if (rates.cashIn) {\n    var cryptoToFiat = new BigNumber(rates.cashIn)\n    var rateStr = formatFiat(cryptoToFiat.round(2).toNumber(), 2)\n\n    $('.crypto-rate-cash-in').html(`1 ${cryptoCode} = ${rateStr}`)\n  }\n\n  if (rates.cashOut) {\n    var cashOut = new BigNumber(rates.cashOut)\n    var cashOutCryptoToFiat = cashOut && formatFiat(cashOut.round(2).toNumber(), 2)\n\n    $('.crypto-rate-cash-out').html(`1 ${cryptoCode} = ${cashOutCryptoToFiat}`)\n  }\n\n  $('.js-crypto-display-units').text(displayCode)\n}\n\nfunction qrize (text, target, color, lightning, size = 'normal') {\n  const image = document.getElementById('bolt-img')\n  // Hack for surf browser\n  const _size = size === 'normal'\n    ? document.body.clientHeight * 0.36\n    : document.body.clientHeight * 0.25\n\n  const opts = {\n    crisp: true,\n    fill: color || 'black',\n    text,\n    size: _size,\n    render: 'canvas',\n    rounded: 50,\n    quiet: 2,\n    mPosX: 50,\n    mPosY: 50,\n    mSize: 30,\n    image\n  }\n\n  if (lightning) {\n    opts.mode = 'image'\n  }\n\n  const el = kjua(opts)\n\n  target.empty().append(el)\n}\n\nfunction setTx (tx) {\n  const txId = tx.id\n  const isPaperWallet = tx.isPaperWallet\n  const hasBills = tx.bills && tx.bills.length > 0\n\n  if (hasBills) {\n    $('.js-inserted-notes').show()\n    $('.js-no-inserted-notes').hide()\n  } else {\n    $('.js-inserted-notes').hide()\n    $('.js-no-inserted-notes').show()\n  }\n\n  $('.js-paper-wallet').toggleClass('hide', !isPaperWallet)\n\n  setCurrentDiscount(tx.discount, tx.promoCodeApplied)\n\n  setTimeout(() => {\n    qrize(txId, $('#cash-in-qr-code'), CASH_IN_QR_COLOR)\n    qrize(txId, $('#cash-in-fail-qr-code'), CASH_IN_QR_COLOR)\n    qrize(txId, $('#cash-in-no-funds-qr-code'), CASH_IN_QR_COLOR, null, 'small')\n    qrize(txId, $('#qr-code-fiat-receipt'), CASH_OUT_QR_COLOR)\n    qrize(txId, $('#qr-code-fiat-complete'), CASH_OUT_QR_COLOR)\n  }, 1000)\n}\n\nfunction formatAddressNoBreakLines (address) {\n  if (!address) return\n  return address.replace(/(.{4})/g, '$1 ')\n}\n\nfunction formatAddress (address) {\n  let toBr = formatAddressNoBreakLines(address)\n  if (!toBr) return\n\n  return toBr.replace(/((.{4} ){5})/g, '$1<br/> ')\n}\n\nfunction setBuyerAddress (address) {\n  $('.crypto-address-no-br').html(formatAddressNoBreakLines(address))\n  $('.crypto-address').html(formatAddress(address))\n}\n\nfunction setAccepting (currentAccepting) {\n  accepting = currentAccepting\n  if (accepting) {\n    $('.bill img').transition({ x: 0, y: -303 }, 1000, 'ease-in')\n  } else {\n    $('.bill img').transition({ x: 0, y: 0 }, 1000, 'ease-out')\n  }\n}\n\nfunction highBill (highestBill, reason) {\n  var reasonText = reason === 'transactionLimit'\n    ? translate('Transaction limit reached.')\n    : translate(\"We're a little low on crypto.\")\n\n  t('high-bill-header', reasonText)\n  t('highest-bill', translate('Please insert %s or less.', [formatFiat(highestBill)]))\n\n  setScreen('high_bill')\n  window.setTimeout(revertScreen, 3000)\n}\n\nfunction minimumTx (lowestBill) {\n  t('lowest-bill', translate('Minimum first bill is %s.', [formatFiat(lowestBill)]))\n\n  setScreen('minimum_tx')\n  window.setTimeout(revertScreen, 3000)\n}\n\nfunction readingBills (bill) {\n  $('.js-processing-bill').html(translate('Processing %s ...', [formatFiat(bill)]))\n  $('.js-continue-crypto-enable').hide()\n  $('.js-send-crypto-enable').hide()\n}\n\nfunction sendOnly (reason) {\n  // TODO: sendOnly should be made into its own state on brain.js\n  if (currentState === 'send_only') return\n\n  const errorMessages = {\n    transactionLimit: translate('Transaction limit reached'),\n    validatorError: translate('Error in validation'),\n    lowBalance: translate(\"We're out of coins!\"),\n    blockedCustomer: translate('Transaction limit reached')\n  }\n\n  // If no reason provided defaults to lowBalance\n  const reasonText = errorMessages[reason] || errorMessages.lowBalance\n  $('#send-only-title').text(reasonText)\n\n  if (reason === 'blockedCustomer') {\n    $('.js-send-only-text').text(translate(\"Due to local regulations, you've reached your transaction limit. Please contact us if you'd like to raise your limit.\"))\n  } else {\n    $('.js-send-only-text').text('')\n  }\n\n  setState('send_only')\n}\n\nfunction setPartialSend (sent, total) {\n  $('#already-sent').text(formatFiat(sent.fiat))\n  $('#pending-sent').text(formatFiat(total.fiat - sent.fiat))\n}\n\nfunction t (id, str) {\n  $('#js-i18n-' + id).html(str)\n}\n\nfunction translateCoin (cryptoCode) {\n  $('.js-i18n-scan-your-address').html(translate('Scan your <br/> %s address', [cryptoCode]))\n  $('.js-i18n-please-scan').html(translate('Please scan the QR code <br/> to send us your %s.', [cryptoCode]))\n  $('.js-i18n-did-send-coins').html(translate('Have you sent the %s yet?', [cryptoCode]))\n  $('.js-i18n-scan-address').html(translate('Scan your %s address', [cryptoCode]))\n  $('.js-i18n-invalid-address').html(translate('Invalid %s address', [cryptoCode]))\n}\n\nfunction initTranslatePage () {\n  $('.js-i18n').each(function () {\n    var el = $(this)\n    el.data('baseTranslation', el.html().trim())\n  })\n  $('input[placeholder]').each(function () {\n    var el = $(this)\n    el.data('baseTranslation', el.attr('placeholder'))\n  })\n}\n\nfunction translatePage () {\n  $('.js-i18n').each(function () {\n    var el = $(this)\n    var base = el.data('baseTranslation')\n    el.html(translate(base))\n  })\n  $('input[placeholder]').each(function () {\n    var el = $(this)\n    var base = el.data('baseTranslation')\n    el.attr('placeholder', translate(base))\n  })\n\n  // Adjust send coins button\n  var length = $('#send-coins span').text().length\n  if (length > 17) $('body').addClass('i18n-long-send-coins')\n  else $('body').removeClass('i18n-long-send-coins')\n}\n\nfunction loadI18n (localeCode) {\n  var messages = locales[localeCode] || locales['en-US']\n\n  return new Jed({\n    'missing_key_callback': function () {},\n    'locale_data': {\n      'messages': messages\n    }\n  })\n}\n\nfunction reachFiatLimit (rec) {\n  var msg = null\n  if (rec.isEmpty) msg = translate(`We're a little low, please cash out`)\n  else if (rec.txLimitReached) msg = translate('Transaction limit reached, please cash out')\n\n  var el = $('.choose_fiat_state .limit')\n  if (msg) el.html(msg).show()\n  else el.hide()\n}\n\nfunction chooseFiat (data) {\n  fiatCredit(data)\n  setState('choose_fiat')\n}\n\nfunction displayCrypto (cryptoAtoms, cryptoCode) {\n  var coin = getCryptoCurrency(cryptoCode)\n  var scale = new BigNumber(10).pow(coin.displayScale)\n  // number of decimal places vary based on displayScale value\n  var decimalPlaces = (coin.displayScale - coin.unitScale) + 6\n  var cryptoAmount = new BigNumber(cryptoAtoms).div(scale).round(decimalPlaces).toNumber()\n  var cryptoDisplay = formatCrypto(cryptoAmount)\n\n  return cryptoDisplay\n}\n\nfunction BN (s) { return new BigNumber(s) }\n\nfunction fiatCredit (data) {\n  var tx = data.tx\n  var cryptoCode = tx.cryptoCode\n  var activeDenominations = data.activeDenominations\n  var coin = getCryptoCurrency(cryptoCode)\n  const fiat = BN(tx.fiat)\n\n  var fiatDisplay = BN(tx.fiat).toNumber().toLocaleString(jsLocaleCode, {\n    useGrouping: true,\n    maximumFractionDigits: 0,\n    minimumFractionDigits: 0\n  })\n\n  var cryptoAtoms = BN(tx.cryptoAtoms)\n  var cryptoDisplay = displayCrypto(cryptoAtoms, cryptoCode)\n\n  var cryptoDisplayCode = coin.displayCode\n\n  setCurrentDiscount(tx.discount, tx.promoCodeApplied)\n\n  if (cryptoAtoms.eq(0) || cryptoAtoms.isNaN()) $('#js-i18n-choose-digital-amount').hide()\n  else $('#js-i18n-choose-digital-amount').show()\n\n  if (fiat.eq(0)) $('#cash-out-button').prop('disabled', true)\n  else $('#cash-out-button').prop('disabled', false)\n\n  updateCassetteButtons(activeDenominations.activeMap, NUMBER_OF_BUTTONS)\n  $('.choose_fiat_state .fiat-amount').text(fiatDisplay)\n  t('choose-digital-amount',\n    translate(\"You'll be sending %s %s\", [cryptoDisplay, cryptoDisplayCode]))\n\n  reachFiatLimit(activeDenominations)\n}\n\nfunction setDepositAddress (depositInfo) {\n  $('.deposit_state .loading').hide()\n  $('.deposit_state .send-notice .crypto-address').html(formatAddress(depositInfo.toAddress))\n  $('.deposit_state .send-notice').show()\n\n  qrize(depositInfo.depositUrl, $('#qr-code-deposit'), CASH_OUT_QR_COLOR)\n}\n\nfunction setVersion (version) {\n  $('.version-number').html(`Version: ${version}`)\n}\n\nfunction deposit (tx) {\n  var cryptoCode = tx.cryptoCode\n  var display = displayCrypto(tx.cryptoAtoms, cryptoCode)\n\n  $('.js-wallet-address').show()\n\n  $('.deposit_state .digital .js-amount').html(display)\n  $('.deposit_state .fiat .js-amount').text(tx.fiat)\n  $('.deposit_state .send-notice').hide()\n  $('#qr-code-deposit').empty()\n  $('.deposit_state .loading').show()\n  $('#qr-code-deposit').show()\n\n  setState('deposit')\n}\n\nfunction fiatReceipt (tx) {\n  var cryptoCode = tx.cryptoCode\n  var display = displayCrypto(tx.cryptoAtoms, cryptoCode)\n\n  $('.fiat_receipt_state .digital .js-amount').html(display)\n  $('.fiat_receipt_state .fiat .js-amount').text(tx.fiat)\n  $('.fiat_receipt_state .sent-coins .crypto-address').html(formatAddress(tx.toAddress))\n\n  setState('fiat_receipt')\n}\n\nfunction fiatComplete (tx) {\n  var cryptoCode = tx.cryptoCode\n  var display = displayCrypto(tx.cryptoAtoms, cryptoCode)\n\n  $('.fiat_complete_state .digital .js-amount').html(display)\n  $('.fiat_complete_state .fiat .js-amount').text(tx.fiat)\n  $('.fiat_complete_state .sent-coins .crypto-address').html(formatAddress(tx.toAddress))\n\n  setState('fiat_complete')\n}\n\nfunction dispenseBatch (data) {\n  $('.batch').css('visibility', data.of === 1 ? 'hidden' : 'visible')\n  $('.batch').text(`${data.current}/${data.of}`)\n}\n\nfunction initDebug () {\n  if (DEBUG_MODE === 'dev') {\n    $('body').css('cursor', 'default')\n    var style = document.createElement('style')\n    style.type = 'text/css'\n    style.innerHTML = 'button { cursor: default !important; }'\n    document.getElementsByTagName('head')[0].appendChild(style)\n\n    return\n  }\n\n  if (DEBUG_MODE === 'demo') {\n    setPrimaryLocales(['en-US'])\n    setLocale('en-US')\n    $('body').css('cursor', 'default')\n    var style = document.createElement('style')\n    style.type = 'text/css'\n    style.innerHTML = 'button { cursor: default !important; }'\n    document.getElementsByTagName('head')[0].appendChild(style)\n\n    if (!SCREEN) {\n      return chooseCoin([\n        { display: 'Bitcoin', cryptoCode: 'BTC' },\n        { display: 'Ethereum', cryptoCode: 'ETH' },\n        { display: 'ZCash', cryptoCode: 'ZEC' }\n      ], true)\n    }\n\n    setState(SCREEN)\n  }\n}\n\nfunction calculateAspectRatio () {\n  const width = $('body').width()\n  const height = $('body').height()\n\n  function gcd (a, b) {\n    return (b === 0) ? a : gcd(b, a % b)\n  }\n\n  const w = width\n  const h = height\n  const r = gcd(w, h)\n  const aspectRatioPt1 = w / r\n  const aspectRatioPt2 = h / r\n\n  if (aspectRatioPt1 < aspectRatioPt2) {\n    aspectRatio = '9:16'\n  } else if (aspectRatioPt1 === 8 && aspectRatioPt2 === 5) {\n    aspectRatio = '16:10'\n  } else if (aspectRatioPt1 === 16 && aspectRatioPt2 === 9) {\n    aspectRatio = '16:9'\n  } else {\n    aspectRatio = w < 1420 ? '16:10' : '16:9'\n  }\n}\n\nlet background = null\n\nfunction doTransition (cb) {\n  // TODO Disable animations for V1\n  let toShow = null\n  let toShowOver = null\n\n  if (isTwoWay) {\n    toShow = ['#bg-to-show']\n    toShowOver = ['.crypto-buttons', '.cash-in-box-wrapper']\n  } else {\n    toShow = ['#bg-to-show']\n    toShowOver = ['header', 'main']\n  }\n\n  two.start()\n  var tl = new TimelineMax()\n  tl.set('.fade-in-delay', { opacity: 0, y: +30 })\n    .set('.fade-in', { opacity: 0, y: +30 })\n    .set(toShow, { zIndex: 1 })\n    .set(toShowOver, { zIndex: 2 })\n    .to(background, 0.5, { scale: isTwoWay ? 3 : 2 })\n    .to('.fade-in', 0.4, {\n      opacity: 1,\n      onStart: cb,\n      y: 0\n    }, '=-0.2')\n    .to('.fade-in-delay', 0.4, { opacity: 1, y: 0 }, '=-0.2')\n    .set(background, { scale: 1 })\n    .set(toShow, { zIndex: -1 })\n    .set(toShowOver, { zIndex: 0 })\n  two.pause()\n}\n\nfunction setupAnimation (isTwoWay, isAr800) {\n  var elem = document.getElementById('bg-to-show')\n  while (elem.firstChild) {\n    elem.removeChild(elem.firstChild)\n  }\n  two = new Two({ fullscreen: true, type: Two.Types.svg, autostart: true }).appendTo(elem)\n\n  let elementId = `${isTwoWay ? 'two-way' : 'one-way'}-${isAr800 ? '800' : '1080'}${isRTL ? '-rtl' : ''}`\n  background = two.interpret(document.getElementById(elementId))\n  background.scale = 1\n}\n\nfunction shouldEnableTouch () {\n  const ua = navigator.userAgent\n  if (ua.match(/surf/ig)) return false\n\n  // ACP has chromium 34 and upboard 73\n  const chromiumVersion = ua.match(/chromium\\/(\\d+)/i)\n  const chromeVersion = ua.match(/chrome\\/(\\d+)/i)\n  const chromiumPlus73 = chromiumVersion && chromiumVersion[1] >= 73\n  const chromePlus73 = chromeVersion && chromeVersion[1] >= 73\n\n  return chromiumPlus73 || chromePlus73\n}\n\nfunction setAvailablePromoCodes (areThereAvailablePromoCodes) {\n  if (areThereAvailablePromoCodes) {\n    $('#insert-first-bill-promo-button').show()\n    $('#insert-first-recycler-bills-promo-button').show()\n    $('#choose-fiat-promo-button').show()\n  } else {\n    $('#insert-first-bill-promo-button').hide()\n    $('#insert-first-recycler-bills-promo-button').hide()\n    $('#choose-fiat-promo-button').hide()\n  }\n}\n\nfunction setCurrentDiscount (currentDiscount, promoCodeApplied) {\n  if (promoCodeApplied) {\n    $('#insert-first-bill-promo-button').hide()\n    $('#insert-first-recycler-bills-promo-button').hide()\n    $('#choose-fiat-promo-button').hide()\n  }\n\n  if (!currentDiscount) {\n    $('#insert-first-bill-code-added').hide()\n    $('#insert-first-recycler-bills-code-added').hide()\n    $('#choose-fiat-code-added').hide()\n  } else if (currentDiscount > 0) {\n    const successMessage = '✔ ' + translate('Discount added (%s off commissions)', [`${currentDiscount}%`])\n    $('#insert-first-bill-code-added').html(successMessage)\n    $('#insert-first-recycler-bills-code-added').html(successMessage)\n    $('#choose-fiat-code-added').html(successMessage)\n    $('#insert-first-bill-code-added').show()\n    $('#insert-first-recycler-bills-code-added').show()\n    $('#choose-fiat-code-added').show()\n\n  } else {\n    $('#insert-first-bill-promo-button').show()\n    $('#insert-first-recycler-bills-promo-button').show()\n    $('#choose-fiat-promo-button').show()\n    $('#insert-first-bill-code-added').hide()\n    $('#insert-first-recycler-bills-code-added').hide()\n    $('#choose-fiat-code-added').hide()\n  }\n}\n\nfunction setReceiptPrint (receiptStatus, smsReceiptStatus) {\n  let status = null\n  if (receiptStatus) status = receiptStatus\n  else status = smsReceiptStatus\n\n  const className = receiptStatus ? 'print-receipt' : 'send-sms-receipt'\n  const printing = receiptStatus ? translate('Printing receipt...') : translate('Sending receipt...')\n  const success = receiptStatus ? translate('Receipt printed successfully!') : translate('Receipt sent successfully!')\n\n  switch (status) {\n    case 'disabled':\n      if (!viewportButtonEventsActive) enableViewportButtonEvents()\n      $(`#${className}-cash-in-message`).addClass('hide')\n      $(`#${className}-cash-in-button`).addClass('hide')\n      $(`#${className}-cash-out-message`).addClass('hide')\n      $(`#${className}-cash-out-button`).addClass('hide')\n      $(`#${className}-cash-in-fail-message`).addClass('hide')\n      $(`#${className}-cash-in-fail-button`).addClass('hide')\n      break\n    case 'available':\n      if (!viewportButtonEventsActive) enableViewportButtonEvents()\n      $(`#${className}-cash-in-message`).addClass('hide')\n      $(`#${className}-cash-in-button`).removeClass('hide')\n      $(`#${className}-cash-out-message`).addClass('hide')\n      $(`#${className}-cash-out-button`).removeClass('hide')\n      $(`#${className}-cash-in-fail-message`).addClass('hide')\n      $(`#${className}-cash-in-fail-button`).removeClass('hide')\n      break\n    case 'printing':\n      if (viewportButtonEventsActive) disableViewportButtonEvents()\n      const message = locale.translate(printing).fetch()\n      $(`#${className}-cash-in-button`).addClass('hide')\n      $(`#${className}-cash-in-message`).html(message)\n      $(`#${className}-cash-in-message`).removeClass('hide')\n      $(`#${className}-cash-out-button`).addClass('hide')\n      $(`#${className}-cash-out-message`).html(message)\n      $(`#${className}-cash-out-message`).removeClass('hide')\n      $(`#${className}-cash-in-fail-button`).addClass('hide')\n      $(`#${className}-cash-in-fail-message`).html(message)\n      $(`#${className}-cash-in-fail-message`).removeClass('hide')\n      break\n    case 'success':\n      if (!viewportButtonEventsActive) enableViewportButtonEvents()\n      const successMessage = '✔ ' + locale.translate(success).fetch()\n      $(`#${className}-cash-in-button`).addClass('hide')\n      $(`#${className}-cash-in-message`).html(successMessage)\n      $(`#${className}-cash-in-message`).removeClass('hide')\n      $(`#${className}-cash-out-button`).addClass('hide')\n      $(`#${className}-cash-out-message`).html(successMessage)\n      $(`#${className}-cash-out-message`).removeClass('hide')\n      $(`#${className}-cash-in-fail-button`).addClass('hide')\n      $(`#${className}-cash-in-fail-message`).html(successMessage)\n      $(`#${className}-cash-in-fail-message`).removeClass('hide')\n      break\n    case 'failed':\n      if (!viewportButtonEventsActive) enableViewportButtonEvents()\n      const failMessage = '✖ ' + locale.translate('An error occurred, try again.').fetch()\n      $(`#${className}-cash-in-button`).addClass('hide')\n      $(`#${className}-cash-in-message`).html(failMessage)\n      $(`#${className}-cash-in-message`).removeClass('hide')\n      $(`#${className}-cash-out-button`).addClass('hide')\n      $(`#${className}-cash-out-message`).html(failMessage)\n      $(`#${className}-cash-out-message`).removeClass('hide')\n      $(`#${className}-cash-in-fail-button`).addClass('hide')\n      $(`#${className}-cash-in-fail-message`).html(failMessage)\n      $(`#${className}-cash-in-fail-message`).removeClass('hide')\n      break\n  }\n}\n\nfunction setScreenOptions (opts) {\n  (opts.rates && opts.rates.active) ? $('#rates-section').show() : $('#rates-section').hide()\n}\n\nfunction thousandSeparator (number, country) {\n  const numberFormatter = Intl.NumberFormat(country)\n  return numberFormatter.format(number)\n}\n\nfunction setRates (allRates, fiat) {\n  const ratesTable = $('.rates-content')\n  const tableHeader = $(`<div class=\"xs-margin-bottom\">\n  <h4 class=\"js-i18n\">${translate('Buy')}</h4>\n  <h4 class=\"js-i18n\">${translate('Crypto')}</h4>\n  <h4 class=\"js-i18n\">${translate('Sell')}</h4>\n</div>`)\n  const coinEntries = []\n\n  Object.keys(allRates).forEach(it => {\n    coinEntries.push($(`<div class=\"xs-margin-bottom\">\n    <p class=\"d2 js-i18n\">${thousandSeparator(BN(allRates[it].cashIn).toFixed(2), localeCode)}</p>\n    <h4 class=\"js-i18n\">${it}</h4>\n    <p class=\"d2 js-i18n\">${thousandSeparator(BN(allRates[it].cashOut).toFixed(2), localeCode)}</p>\n  </div>`))\n  })\n\n  $('#rates-fiat-currency').text(fiat)\n  ratesTable.empty().append(tableHeader).append(coinEntries)\n}\n\nfunction setAutomaticPrint (automaticPrint) {\n  if (automaticPrint) {\n    $('#print-receipt-cash-in-button').hide()\n    $('#print-receipt-cash-out-button').hide()\n    $('#print-receipt-cash-in-fail-button').hide()\n  } else {\n    $('#print-receipt-cash-in-button').show()\n    $('#print-receipt-cash-out-button').show()\n    $('#print-receipt-cash-in-fail-button').show()\n  }\n}\n\nfunction suspiciousAddress (blacklistMessage) {\n  if (blacklistMessage) {\n    $(`#suspicious-address-message`).html(blacklistMessage)\n  } else {\n    $(`#suspicious-address-message`).html(translate(\"This address may be associated with a deceptive offer or a prohibited group. Please make sure you\\'re using an address from your own wallet.\"))\n  }\n}\n"]}